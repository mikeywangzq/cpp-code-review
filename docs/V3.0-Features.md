# C++ Code Review Agent V3.0 å®Œæ•´åŠŸèƒ½æ–‡æ¡£

<div align="center">

## ğŸš€ V3.0 å…¨è‡ªåŠ¨åŒ–ç‰ˆæœ¬

**AI é©±åŠ¨ Â· è‡ªåŠ¨ä¿®å¤ Â· å¤šå¹³å°é›†æˆ Â· é«˜çº§å®‰å…¨åˆ†æ**

</div>

---

## ğŸ“‹ ç›®å½•

- [æ¦‚è¿°](#æ¦‚è¿°)
- [1. è‡ªåŠ¨ä»£ç ä¿®å¤](#1-è‡ªåŠ¨ä»£ç ä¿®å¤)
- [2. LLM API é›†æˆ](#2-llm-api-é›†æˆ)
- [3. VS Code æ‰©å±•](#3-vs-code-æ‰©å±•)
- [4. CI/CD å¤šå¹³å°é›†æˆ](#4-cicd-å¤šå¹³å°é›†æˆ)
- [5. æ•°æ®æµæ±¡ç‚¹åˆ†æ](#5-æ•°æ®æµæ±¡ç‚¹åˆ†æ)
- [æ¶æ„è®¾è®¡](#æ¶æ„è®¾è®¡)
- [API å‚è€ƒ](#api-å‚è€ƒ)

---

## æ¦‚è¿°

V3.0 æ˜¯ä¸€ä¸ªé‡å¤§ç‰ˆæœ¬æ›´æ–°ï¼Œå¼•å…¥äº†äº”å¤§æ ¸å¿ƒåŠŸèƒ½æ¨¡å—ï¼Œå°†é¡¹ç›®ä»é™æ€åˆ†æå·¥å…·å‡çº§ä¸ºå®Œæ•´çš„è‡ªåŠ¨åŒ–ä»£ç è´¨é‡å¹³å°ã€‚

### ç‰ˆæœ¬å¯¹æ¯”

| åŠŸèƒ½ | V1.0 | V2.0 | V3.0 |
|------|------|------|------|
| åŸºç¡€æ£€æµ‹è§„åˆ™ | âœ… 4æ¡ | âœ… 7æ¡ | âœ… 10æ¡ |
| LLM æ™ºèƒ½å»ºè®® | âŒ | âœ… è§„åˆ™å¼•æ“ | âœ… GPT-4/Claude |
| è‡ªåŠ¨ä¿®å¤ | âŒ | âŒ | âœ… |
| IDE é›†æˆ | âŒ | âŒ | âœ… VS Code |
| CI/CD é›†æˆ | âŒ | âœ… GitHub | âœ… 4å¹³å° |
| æ±¡ç‚¹åˆ†æ | âŒ | âŒ | âœ… |

---

## 1. è‡ªåŠ¨ä»£ç ä¿®å¤

### 1.1 æ¦‚è¿°

è‡ªåŠ¨ä»£ç ä¿®å¤ç³»ç»Ÿèƒ½å¤Ÿæ™ºèƒ½åœ°ç”Ÿæˆå’Œåº”ç”¨ä»£ç ä¿®å¤ï¼Œæ— éœ€æ‰‹åŠ¨ç¼–è¾‘ã€‚

### 1.2 æ ¸å¿ƒç»„ä»¶

**æ–‡ä»¶ä½ç½®:**
- `src/fixer/auto_fixer.h` - å¤´æ–‡ä»¶
- `src/fixer/auto_fixer.cpp` - å®ç°æ–‡ä»¶

**ä¸»è¦ç±»:**

```cpp
class AutoFixer {
public:
    explicit AutoFixer(bool create_backup = true);

    // ç”Ÿæˆä¿®å¤
    std::optional<FixAction> generateFix(const Issue& issue);

    // åº”ç”¨ä¿®å¤
    bool applyFix(const FixAction& fix);

    // æ‰¹é‡ä¿®å¤
    FixResult fixAll(const Reporter& reporter,
                     Severity filter_severity = Severity::LOW);

    // å›æ»š
    bool rollback();
};
```

### 1.3 æ”¯æŒçš„ä¿®å¤ç±»å‹

| è§„åˆ™ ID | ä¿®å¤ç±»å‹ | æè¿° |
|---------|----------|------|
| NULL-PTR-001 | ç©ºæŒ‡é’ˆæ£€æŸ¥ | è‡ªåŠ¨æ·»åŠ  `if (ptr != nullptr)` |
| UNINIT-VAR-001 | å˜é‡åˆå§‹åŒ– | è‡ªåŠ¨æ·»åŠ åˆå§‹åŒ–å€¼ |
| ASSIGN-COND-001 | èµ‹å€¼ä¿®æ­£ | å°† `=` æ›¿æ¢ä¸º `==` |
| UNSAFE-C-FUNC-001 | å‡½æ•°æ›¿æ¢ | strcpy â†’ strncpy |
| MEMORY-LEAK-001 | å¤´æ–‡ä»¶æ·»åŠ  | æ·»åŠ  `#include <memory>` |

### 1.4 ä½¿ç”¨ç¤ºä¾‹

#### åŸºæœ¬ç”¨æ³•

```bash
# è‡ªåŠ¨ä¿®å¤æ‰€æœ‰é—®é¢˜
cpp-agent scan main.cpp --auto-fix

# åªä¿®å¤ä¸¥é‡é—®é¢˜
cpp-agent scan main.cpp --auto-fix --severity-filter=CRITICAL,HIGH

# äº¤äº’å¼ä¿®å¤ï¼ˆè¯¢é—®ç”¨æˆ·ç¡®è®¤ï¼‰
cpp-agent scan main.cpp --auto-fix --interactive

# ç¦ç”¨å¤‡ä»½
cpp-agent scan main.cpp --auto-fix --no-backup
```

#### ç¼–ç¨‹æ¥å£

```cpp
#include "fixer/auto_fixer.h"

// åˆ›å»ºä¿®å¤å™¨
AutoFixer fixer(true);  // å¯ç”¨å¤‡ä»½

// ä¿®å¤æ‰€æœ‰é—®é¢˜
Reporter reporter;
// ... æ·»åŠ é—®é¢˜åˆ° reporter ...

FixResult result = fixer.fixAll(reporter, Severity::HIGH);

if (result.success) {
    std::cout << "ä¿®å¤äº† " << result.fixed_count << " ä¸ªé—®é¢˜\n";
    std::cout << "ä¿®æ”¹äº† " << result.modified_files.size() << " ä¸ªæ–‡ä»¶\n";
}

// å¦‚æœéœ€è¦å›æ»š
if (!satisfied) {
    fixer.rollback();
}
```

### 1.5 ä¿®å¤æ“ä½œç±»å‹

```cpp
enum class FixType {
    REPLACE,        // æ›¿æ¢æ–‡æœ¬
    INSERT,         // æ’å…¥æ–‡æœ¬
    DELETE,         // åˆ é™¤æ–‡æœ¬
    ADD_INCLUDE,    // æ·»åŠ å¤´æ–‡ä»¶
    REWRITE         // å®Œå…¨é‡å†™
};
```

### 1.6 å®‰å…¨ç‰¹æ€§

- âœ… **è‡ªåŠ¨å¤‡ä»½**: ä¿®æ”¹å‰åˆ›å»º `.backup` æ–‡ä»¶
- âœ… **åŸå­æ“ä½œ**: æ–‡ä»¶å†™å…¥å¤±è´¥æ—¶ä¿æŒåŸçŠ¶
- âœ… **å›æ»šæ”¯æŒ**: ä¸€é”®æ¢å¤æ‰€æœ‰ä¿®æ”¹
- âœ… **äº¤äº’æ¨¡å¼**: ä¿®å¤å‰é¢„è§ˆå’Œç¡®è®¤

---

## 2. LLM API é›†æˆ

### 2.1 æ¦‚è¿°

å®Œæ•´é›†æˆ OpenAI GPT-4 å’Œ Anthropic Claude APIï¼Œæä¾› AI é©±åŠ¨çš„æ™ºèƒ½ä¿®å¤å»ºè®®ã€‚

### 2.2 æ ¸å¿ƒç»„ä»¶

**æ–‡ä»¶ä½ç½®:**
- `src/llm/api_client.h` - API å®¢æˆ·ç«¯å¤´æ–‡ä»¶
- `src/llm/api_client.cpp` - HTTP å®¢æˆ·ç«¯å®ç°
- `src/llm/llm_enhancer.h` - LLM å¢å¼ºå™¨ï¼ˆæ›´æ–°ï¼‰
- `src/llm/llm_enhancer.cpp` - æä¾›è€…å®ç°ï¼ˆæ›´æ–°ï¼‰

### 2.3 æ¶æ„è®¾è®¡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      LLM Provider Factory           â”‚
â”‚  create(type, config) -> Provider   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
       â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”
       â”‚               â”‚
â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ RuleBased   â”‚  â”‚   OpenAI     â”‚  â”‚  Anthropic   â”‚
â”‚  Provider   â”‚  â”‚   Provider   â”‚  â”‚   Provider   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.4 æä¾›è€…ç±»å‹

#### 2.4.1 åŸºäºè§„åˆ™çš„æä¾›è€…

```cpp
class RuleBasedProvider : public LLMProvider {
    // å†…ç½®æ™ºèƒ½ç³»ç»Ÿï¼Œæ— éœ€å¤–éƒ¨ API
    // 7 ç§ä¸“é—¨çš„è§„åˆ™å¤„ç†å™¨
    // é›¶æˆæœ¬ï¼Œé›¶å»¶è¿Ÿï¼Œå®Œå…¨ç¦»çº¿
};
```

**ç‰¹ç‚¹:**
- âœ… æ— éœ€ API å¯†é’¥
- âœ… å®Œå…¨ç¦»çº¿å·¥ä½œ
- âœ… å³æ—¶å“åº”
- âœ… è¯¦ç»†çš„ä¿®å¤ç­–ç•¥

#### 2.4.2 OpenAI Provider

```cpp
class OpenAIProvider : public LLMProvider {
public:
    explicit OpenAIProvider(const std::string& api_key);
    std::string generateSuggestion(const Issue& issue,
                                   const std::string& code_context) override;
};
```

**ç‰¹ç‚¹:**
- ğŸ¤– GPT-4 æ¨¡å‹æ”¯æŒ
- ğŸ“š ä¸Šä¸‹æ–‡æ„ŸçŸ¥
- ğŸ¯ æ ¹å› åˆ†æ
- âš¡ è‡ªåŠ¨å›é€€æœºåˆ¶

#### 2.4.3 Anthropic Provider

```cpp
class AnthropicProvider : public LLMProvider {
public:
    explicit AnthropicProvider(const std::string& api_key);
    std::string generateSuggestion(const Issue& issue,
                                   const std::string& code_context) override;
};
```

**ç‰¹ç‚¹:**
- ğŸ§  Claude Sonnet/Opus æ”¯æŒ
- ğŸ“– é•¿æ–‡æœ¬ä¸Šä¸‹æ–‡ï¼ˆ200K tokensï¼‰
- ğŸ’¡ è¯¦ç»†çš„ä¿®å¤å»ºè®®
- âš¡ è‡ªåŠ¨å›é€€æœºåˆ¶

### 2.5 ä½¿ç”¨ç¤ºä¾‹

#### ç¯å¢ƒå˜é‡é…ç½®

```bash
# OpenAI
export OPENAI_API_KEY="sk-your-openai-key"

# Anthropic
export ANTHROPIC_API_KEY="sk-ant-your-anthropic-key"
```

#### å‘½ä»¤è¡Œä½¿ç”¨

```bash
# ä½¿ç”¨ OpenAI GPT-4
cpp-agent scan main.cpp --enable-ai --ai-provider=openai

# ä½¿ç”¨ Anthropic Claude
cpp-agent scan main.cpp --enable-ai --ai-provider=anthropic

# ä½¿ç”¨è§„åˆ™å¼•æ“ï¼ˆé»˜è®¤ï¼‰
cpp-agent scan main.cpp --enable-ai --ai-provider=rule-based
```

#### ç¼–ç¨‹æ¥å£

```cpp
#include "llm/llm_enhancer.h"

// åˆ›å»º OpenAI æä¾›è€…
auto provider = LLMProviderFactory::create(
    LLMProviderFactory::ProviderType::OPENAI,
    std::getenv("OPENAI_API_KEY")
);

// åˆ›å»ºå¢å¼ºå™¨
LLMEnhancer enhancer(provider);

// å¢å¼ºé—®é¢˜
Issue enhanced = enhancer.enhanceIssue(original_issue, code_context);

std::cout << enhanced.suggestion << "\n";
```

### 2.6 HTTP å®¢æˆ·ç«¯

åŸºäº libcurl å®ç°ï¼Œæ”¯æŒ HTTPS è¯·æ±‚ã€‚

```cpp
class HTTPClient {
public:
    static APIResponse post(const std::string& url,
                           const std::map<std::string, std::string>& headers,
                           const std::string& body);

    static APIResponse get(const std::string& url,
                          const std::map<std::string, std::string>& headers);
};
```

**ç¼–è¯‘é€‰é¡¹:**

```bash
# å¯ç”¨ CURL æ”¯æŒ
cmake -DENABLE_CURL=ON ..
make
```

### 2.7 é”™è¯¯å¤„ç†

```cpp
try {
    OpenAIClient client(api_key);
    APIResponse response = client.complete(prompt);

    if (response.success) {
        // å¤„ç†æˆåŠŸå“åº”
    } else {
        // API é”™è¯¯ï¼Œè‡ªåŠ¨å›é€€åˆ°è§„åˆ™å¼•æ“
        RuleBasedProvider fallback;
        return fallback.generateSuggestion(issue, context);
    }
} catch (const std::exception& e) {
    // å¼‚å¸¸å¤„ç†ï¼Œå›é€€åˆ°è§„åˆ™å¼•æ“
}
```

---

## 3. VS Code æ‰©å±•

### 3.1 æ¦‚è¿°

å®æ—¶ä»£ç å®¡æŸ¥ VS Code æ‰©å±•ï¼Œåœ¨ç¼–è¾‘å™¨ä¸­ç›´æ¥æ˜¾ç¤ºé—®é¢˜å’Œä¿®å¤å»ºè®®ã€‚

### 3.2 æ–‡ä»¶ç»“æ„

```
vscode-extension/
â”œâ”€â”€ package.json          # æ‰©å±•é…ç½®
â”œâ”€â”€ tsconfig.json         # TypeScript é…ç½®
â”œâ”€â”€ README.md             # æ‰©å±•æ–‡æ¡£
â””â”€â”€ src/
    â””â”€â”€ extension.ts      # æ‰©å±•ä¸»ç¨‹åº
```

### 3.3 åŠŸèƒ½ç‰¹æ€§

| åŠŸèƒ½ | æè¿° | å¿«æ·é”® |
|------|------|--------|
| è‡ªåŠ¨å®¡æŸ¥ | ä¿å­˜æ—¶è‡ªåŠ¨è¿è¡Œ | - |
| åˆ†ææ–‡ä»¶ | åˆ†æå½“å‰æ–‡ä»¶ | Ctrl+Shift+R |
| è‡ªåŠ¨ä¿®å¤ | åº”ç”¨ä¿®å¤å»ºè®® | Ctrl+Shift+F |
| æ¸…é™¤è¯Šæ–­ | æ¸…é™¤æ‰€æœ‰æ ‡è®° | - |
| åˆ†æå·¥ä½œåŒº | åˆ†ææ•´ä¸ªé¡¹ç›® | - |

### 3.4 é…ç½®é€‰é¡¹

#### åŸºç¡€é…ç½®

```json
{
  "cpp-review.executablePath": "cpp-agent",
  "cpp-review.cppStandard": "c++17",
  "cpp-review.enableAutoReview": true,
  "cpp-review.severityFilter": ["CRITICAL", "HIGH", "MEDIUM"]
}
```

#### AI é…ç½®

```json
{
  "cpp-review.enableAISuggestions": true,
  "cpp-review.aiProvider": "openai",
  "cpp-review.openaiApiKey": "sk-your-key",
  "cpp-review.anthropicApiKey": "sk-ant-your-key"
}
```

#### é«˜çº§é…ç½®

```json
{
  "cpp-review.enableTaintAnalysis": true,
  "cpp-review.enableAutoReview": true
}
```

### 3.5 å®‰è£…å’Œä½¿ç”¨

#### å®‰è£…æ‰©å±•

```bash
cd vscode-extension
npm install
npm run compile

# æ‰“åŒ…æ‰©å±•
npm install -g vsce
vsce package

# å®‰è£…åˆ° VS Code
code --install-extension cpp-code-review-1.0.0.vsix
```

#### ä½¿ç”¨æµç¨‹

1. **æ‰“å¼€ C++ æ–‡ä»¶** - æ‰©å±•è‡ªåŠ¨æ¿€æ´»
2. **ç¼–è¾‘ä»£ç ** - å®æ—¶è¯­æ³•é«˜äº®
3. **ä¿å­˜æ–‡ä»¶** - è‡ªåŠ¨è¿è¡Œå®¡æŸ¥
4. **æŸ¥çœ‹é—®é¢˜** - åœ¨"é—®é¢˜"é¢æ¿ä¸­æŸ¥çœ‹
5. **åº”ç”¨ä¿®å¤** - ä½¿ç”¨å¿«æ·é”®æˆ–å‘½ä»¤é¢æ¿

### 3.6 è¯Šæ–­ç³»ç»Ÿ

```typescript
// ä¸¥é‡æ€§æ˜ å°„
function mapSeverity(severity: string): vscode.DiagnosticSeverity {
    switch (severity.toUpperCase()) {
        case 'CRITICAL':
        case 'HIGH':
            return vscode.DiagnosticSeverity.Error;
        case 'MEDIUM':
            return vscode.DiagnosticSeverity.Warning;
        case 'LOW':
            return vscode.DiagnosticSeverity.Information;
        case 'SUGGESTION':
            return vscode.DiagnosticSeverity.Hint;
    }
}
```

### 3.7 å‘½ä»¤å‚è€ƒ

| å‘½ä»¤ ID | æ ‡é¢˜ | åŠŸèƒ½ |
|---------|------|------|
| `cpp-review.analyze` | Analyze Workspace | åˆ†ææ•´ä¸ªå·¥ä½œåŒº |
| `cpp-review.analyzeFile` | Analyze Current File | åˆ†æå½“å‰æ–‡ä»¶ |
| `cpp-review.autoFix` | Auto Fix Issues | è‡ªåŠ¨ä¿®å¤é—®é¢˜ |
| `cpp-review.clearDiagnostics` | Clear Diagnostics | æ¸…é™¤è¯Šæ–­ |

---

## 4. CI/CD å¤šå¹³å°é›†æˆ

### 4.1 æ¦‚è¿°

æ”¯æŒ 4 å¤§ä¸»æµ CI/CD å¹³å°ï¼Œæä¾›å¼€ç®±å³ç”¨çš„é…ç½®æ–‡ä»¶ã€‚

### 4.2 å¹³å°æ”¯æŒ

| å¹³å° | é…ç½®æ–‡ä»¶ | PR è¯„è®º | è‡ªåŠ¨ä¿®å¤ | å®šæ—¶æ‰«æ |
|------|----------|---------|----------|----------|
| GitHub Actions | âœ… | âœ… | âœ… | âœ… |
| GitLab CI/CD | âœ… | âœ… | âŒ | âœ… |
| CircleCI | âœ… | âŒ | âŒ | âœ… |
| Jenkins | âœ… | âš ï¸ | âŒ | âœ… |

### 4.3 GitHub Actions

**æ–‡ä»¶:** `.github/workflows/code-review.yml`

#### å®Œæ•´é…ç½®

```yaml
name: C++ Code Review

on:
  push:
    branches: [ main, master, develop ]
  pull_request:
    branches: [ main, master, develop ]

jobs:
  code-review:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
        with:
          fetch-depth: 0

      - name: Install Dependencies
        run: |
          sudo apt-get update
          sudo apt-get install -y build-essential cmake \
            llvm-14 llvm-14-dev clang-14 libclang-14-dev \
            libcurl4-openssl-dev

      - name: Build cpp-agent
        run: |
          mkdir -p build && cd build
          cmake .. -DENABLE_CURL=ON
          make -j$(nproc)

      - name: Run Code Review (PR)
        if: github.event_name == 'pull_request'
        env:
          OPENAI_API_KEY: ${{ secrets.OPENAI_API_KEY }}
          ANTHROPIC_API_KEY: ${{ secrets.ANTHROPIC_API_KEY }}
        run: |
          ./build/cpp-agent --pr \
            --pr-comment=pr-review.md \
            --enable-taint-analysis \
            --std=c++17

      - name: Post PR Comment
        if: github.event_name == 'pull_request'
        uses: actions/github-script@v6
        with:
          github-token: ${{ secrets.GITHUB_TOKEN }}
          script: |
            const fs = require('fs');
            const comment = fs.readFileSync('pr-review.md', 'utf8');
            github.rest.issues.createComment({
              issue_number: context.issue.number,
              owner: context.repo.owner,
              repo: context.repo.repo,
              body: comment
            });

      - name: Check Critical Issues
        run: |
          if grep -q "CRITICAL\|HIGH" pr-review.md; then
            echo "âš ï¸ å‘ç°ä¸¥é‡é—®é¢˜ï¼"
            exit 1
          fi
```

#### å¯†é’¥é…ç½®

åœ¨ GitHub ä»“åº“è®¾ç½®ä¸­æ·»åŠ ï¼š
- `OPENAI_API_KEY` - OpenAI API å¯†é’¥
- `ANTHROPIC_API_KEY` - Anthropic API å¯†é’¥

### 4.4 GitLab CI/CD

**æ–‡ä»¶:** `.gitlab-ci.yml`

#### æ ¸å¿ƒé…ç½®

```yaml
stages:
  - build
  - review
  - report

variables:
  CPP_STANDARD: "c++17"
  ENABLE_TAINT_ANALYSIS: "true"

build:
  stage: build
  script:
    - mkdir -p build && cd build
    - cmake .. -DENABLE_CURL=ON
    - make -j$(nproc)
  artifacts:
    paths:
      - build/cpp-agent

review:mr:
  stage: review
  only:
    - merge_requests
  script:
    - ./build/cpp-agent --pr --pr-comment=mr-review.md
  artifacts:
    reports:
      codequality: gl-code-quality-report.json
```

#### å˜é‡é…ç½®

åœ¨ GitLab é¡¹ç›®è®¾ç½®ä¸­æ·»åŠ ï¼š
- `OPENAI_API_KEY` - OpenAI API å¯†é’¥ï¼ˆå¯é€‰ï¼‰
- `ANTHROPIC_API_KEY` - Anthropic API å¯†é’¥ï¼ˆå¯é€‰ï¼‰

### 4.5 CircleCI

**æ–‡ä»¶:** `.circleci/config.yml`

```yaml
version: 2.1

executors:
  cpp-executor:
    docker:
      - image: ubuntu:22.04

jobs:
  build:
    executor: cpp-executor
    steps:
      - checkout
      - run:
          name: Build
          command: |
            mkdir -p build && cd build
            cmake .. -DENABLE_CURL=ON
            make -j$(nproc)
      - persist_to_workspace:
          root: .
          paths:
            - build/cpp-agent

  code-review:
    executor: cpp-executor
    steps:
      - checkout
      - attach_workspace:
          at: .
      - run:
          name: Review
          command: |
            ./build/cpp-agent --incremental \
              --enable-taint-analysis

workflows:
  main:
    jobs:
      - build
      - code-review:
          requires:
            - build
```

### 4.6 Jenkins

**æ–‡ä»¶:** `Jenkinsfile`

```groovy
pipeline {
    agent {
        docker {
            image 'ubuntu:22.04'
        }
    }

    environment {
        CPP_STANDARD = 'c++17'
        ENABLE_TAINT = 'true'
    }

    stages {
        stage('Build') {
            steps {
                sh '''
                    mkdir -p build && cd build
                    cmake .. -DENABLE_CURL=ON
                    make -j$(nproc)
                '''
            }
        }

        stage('Code Review') {
            steps {
                sh '''
                    ./build/cpp-agent --pr \
                        --pr-comment=pr-review.md \
                        --std=$CPP_STANDARD
                '''
            }
        }

        stage('Generate Report') {
            steps {
                sh '''
                    ./build/cpp-agent scan . \
                        --html-output=report.html
                '''
                publishHTML([
                    reportName: 'Code Review Report',
                    reportFiles: 'report.html'
                ])
            }
        }
    }
}
```

### 4.7 æœ€ä½³å®è·µ

#### 1. å¢é‡åˆ†æ

```yaml
# åªåˆ†æå˜æ›´çš„æ–‡ä»¶
- run: ./build/cpp-agent --incremental
```

#### 2. ä¸¥é‡æ€§è¿‡æ»¤

```yaml
# åªæ£€æŸ¥ä¸¥é‡å’Œé«˜ä¼˜å…ˆçº§é—®é¢˜
- run: ./build/cpp-agent --severity-filter=CRITICAL,HIGH
```

#### 3. å®šæ—¶å…¨é‡æ‰«æ

```yaml
# GitHub Actions
on:
  schedule:
    - cron: '0 0 * * 0'  # æ¯å‘¨æ—¥è¿è¡Œ
```

#### 4. ç¼“å­˜ä¾èµ–

```yaml
# CircleCI
- restore_cache:
    keys:
      - v1-dependencies-{{ checksum "CMakeLists.txt" }}
```

---

## 5. æ•°æ®æµæ±¡ç‚¹åˆ†æ

### 5.1 æ¦‚è¿°

é«˜çº§å®‰å…¨æ¼æ´æ£€æµ‹ç³»ç»Ÿï¼Œé€šè¿‡è·Ÿè¸ªä¸å—ä¿¡ä»»çš„æ•°æ®æµæ¥å‘ç°æ½œåœ¨çš„å®‰å…¨é—®é¢˜ã€‚

### 5.2 æ ¸å¿ƒç»„ä»¶

**æ–‡ä»¶ä½ç½®:**
- `src/analysis/taint_analysis.h` - æ±¡ç‚¹åˆ†æå¤´æ–‡ä»¶
- `src/analysis/taint_analysis.cpp` - æ±¡ç‚¹åˆ†æå®ç°

### 5.3 åˆ†æåŸç†

```
æºç‚¹ (Source) â†’ ä¼ æ’­ (Propagation) â†’ æ±‡ç‚¹ (Sink)
     â†“                   â†“                   â†“
  ç”¨æˆ·è¾“å…¥           èµ‹å€¼/å‡½æ•°è°ƒç”¨        æ•æ„Ÿæ“ä½œ
```

### 5.4 æ±¡ç‚¹ç±»å‹

```cpp
enum class TaintType {
    USER_INPUT,      // ç”¨æˆ·è¾“å…¥
    NETWORK_DATA,    // ç½‘ç»œæ•°æ®
    FILE_DATA,       // æ–‡ä»¶æ•°æ®
    ENVIRONMENT,     // ç¯å¢ƒå˜é‡
    DATABASE,        // æ•°æ®åº“æ•°æ®
    UNKNOWN          // æœªçŸ¥æ¥æº
};
```

### 5.5 æºç‚¹ (Taint Sources)

#### ç”¨æˆ·è¾“å…¥

```cpp
// æ ‡å‡†è¾“å…¥
std::cin >> user_input;
std::getline(std::cin, line);
scanf("%s", buffer);
gets(buffer);  // å±é™©ï¼

// å‘½ä»¤è¡Œå‚æ•°
argv[1]
getopt()
```

#### ç½‘ç»œæ•°æ®

```cpp
recv(sockfd, buffer, len, flags);
recvfrom(sockfd, buffer, len, flags, addr, addrlen);
read(sockfd, buffer, len);
SSL_read(ssl, buffer, len);
```

#### æ–‡ä»¶æ•°æ®

```cpp
fread(buffer, size, count, fp);
fgets(buffer, size, fp);
fscanf(fp, format, ...);
```

#### ç¯å¢ƒå˜é‡

```cpp
char* env = getenv("PATH");
```

### 5.6 æ±‡ç‚¹ (Taint Sinks)

#### SQL æŸ¥è¯¢

```cpp
// å±é™©ç¤ºä¾‹
std::string query = "SELECT * FROM users WHERE id = " + user_id;
mysql_query(conn, query.c_str());  // SQL æ³¨å…¥é£é™©ï¼

// å®‰å…¨æ›¿ä»£
PreparedStatement* stmt = conn->prepareStatement(
    "SELECT * FROM users WHERE id = ?"
);
stmt->setInt(1, user_id);
```

#### å‘½ä»¤æ‰§è¡Œ

```cpp
// å±é™©ç¤ºä¾‹
std::string cmd = "rm -rf " + user_path;
system(cmd.c_str());  // å‘½ä»¤æ³¨å…¥é£é™©ï¼

// å®‰å…¨æ›¿ä»£
if (isValidPath(user_path)) {
    std::filesystem::remove_all(user_path);
}
```

#### æ–‡ä»¶æ“ä½œ

```cpp
// å±é™©ç¤ºä¾‹
FILE* fp = fopen(user_filename.c_str(), "r");  // è·¯å¾„éå†é£é™©ï¼

// å®‰å…¨æ›¿ä»£
std::filesystem::path safe_path = std::filesystem::canonical(user_filename);
if (safe_path.string().starts_with("/safe/directory/")) {
    FILE* fp = fopen(safe_path.c_str(), "r");
}
```

### 5.7 å‡€åŒ–å‡½æ•°

ç³»ç»Ÿä¼šè¯†åˆ«å¸¸è§çš„å‡€åŒ–å‡½æ•°ï¼š

```cpp
// éªŒè¯å‡½æ•°
validate_input()
isValid()
check()

// è½¬ä¹‰å‡½æ•°
escape()
sanitize()
htmlspecialchars()
mysql_real_escape_string()

// ç¼–ç å‡½æ•°
urlencode()
base64_encode()
```

### 5.8 ä½¿ç”¨ç¤ºä¾‹

#### å‘½ä»¤è¡Œ

```bash
# å¯ç”¨æ±¡ç‚¹åˆ†æ
cpp-agent scan src/ --enable-taint-analysis

# åªæ˜¾ç¤ºæ±¡ç‚¹åˆ†æç»“æœ
cpp-agent scan src/ --enable-taint-analysis --rules=TAINT-ANALYSIS-001
```

#### ç¼–ç¨‹æ¥å£

```cpp
#include "analysis/taint_analysis.h"

// åˆ›å»ºåˆ†æå™¨
TaintAnalyzer analyzer(context, reporter);

// åˆ†æå‡½æ•°
const FunctionDecl* func = ...;
analyzer.analyzeFunction(func);

// è·å–æ±¡ç‚¹è·¯å¾„
const auto& paths = analyzer.getTaintPaths();
for (const auto& path : paths) {
    std::cout << "æ±¡ç‚¹æµ: "
              << path.source.variable_name << " â†’ "
              << path.sink.function_name << "\n";
}
```

### 5.9 æ£€æµ‹ç¤ºä¾‹

#### SQL æ³¨å…¥æ£€æµ‹

```cpp
void vulnerable_function() {
    std::string user_id;
    std::cin >> user_id;  // æ±¡ç‚¹æº

    std::string query = "SELECT * FROM users WHERE id = " + user_id;
    mysql_query(conn, query.c_str());  // æ±¡ç‚¹æ±‡

    // æ£€æµ‹ç»“æœ:
    // ğŸš¨ æ½œåœ¨çš„SQLæ³¨å…¥æ¼æ´
    // ä¸å—ä¿¡ä»»çš„æ•°æ®ä» 'user_id' (ç¬¬ 3 è¡Œ)
    // æµå‘æ•æ„Ÿå‡½æ•° 'mysql_query' (ç¬¬ 6 è¡Œ)
}
```

#### å‘½ä»¤æ³¨å…¥æ£€æµ‹

```cpp
void execute_command() {
    std::string filename;
    std::getline(std::cin, filename);  // æ±¡ç‚¹æº

    std::string cmd = "cat " + filename;
    system(cmd.c_str());  // æ±¡ç‚¹æ±‡

    // æ£€æµ‹ç»“æœ:
    // ğŸš¨ æ½œåœ¨çš„å‘½ä»¤æ³¨å…¥æ¼æ´
    // ä¸å—ä¿¡ä»»çš„æ•°æ®ä» 'filename' (ç¬¬ 3 è¡Œ)
    // æµå‘æ•æ„Ÿå‡½æ•° 'system' (ç¬¬ 6 è¡Œ)
}
```

#### å®‰å…¨ä¿®å¤

```cpp
void safe_function() {
    std::string user_id;
    std::cin >> user_id;

    // éªŒè¯è¾“å…¥
    if (!std::all_of(user_id.begin(), user_id.end(), ::isdigit)) {
        throw std::invalid_argument("Invalid user ID");
    }

    // ä½¿ç”¨å‚æ•°åŒ–æŸ¥è¯¢
    PreparedStatement* stmt = conn->prepareStatement(
        "SELECT * FROM users WHERE id = ?"
    );
    stmt->setInt(1, std::stoi(user_id));

    // âœ… å®‰å…¨ï¼šæ²¡æœ‰æ±¡ç‚¹æµå‘æ•æ„Ÿæ“ä½œ
}
```

### 5.10 æ±¡ç‚¹ä¼ æ’­

ç³»ç»Ÿè·Ÿè¸ªä»¥ä¸‹ä¼ æ’­é€”å¾„ï¼š

```cpp
// 1. ç›´æ¥èµ‹å€¼
tainted_var = user_input;

// 2. å‡½æ•°è¿”å›å€¼
std::string result = process(user_input);

// 3. å®¹å™¨æ“ä½œ
vec.push_back(user_input);
map[key] = user_input;

// 4. å­—ç¬¦ä¸²æ‹¼æ¥
std::string msg = "Hello " + user_input;

// 5. æˆå‘˜èµ‹å€¼
obj.field = user_input;
```

---

## æ¶æ„è®¾è®¡

### æ•´ä½“æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     CLI Interface                       â”‚
â”‚              å‘½ä»¤è¡Œå‚æ•°è§£æå’Œç”¨æˆ·äº¤äº’                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  Rule Engine                            â”‚
â”‚      è§„åˆ™æ³¨å†Œã€è§„åˆ™æ‰§è¡Œã€é—®é¢˜æ”¶é›†                         â”‚
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚            â”‚            â”‚            â”‚
â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â–¼â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚AST Parserâ”‚ â”‚ Fixer  â”‚ â”‚   LLM     â”‚ â”‚Taint Analysisâ”‚
â”‚Clang/LLVMâ”‚ â”‚Auto Fixâ”‚ â”‚ Enhancer  â”‚ â”‚Security Scan â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚                       â”‚
            â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚  RuleBased   â”‚      â”‚  API Providers  â”‚
            â”‚   Provider   â”‚      â”‚ OpenAI/Anthropicâ”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ¨¡å—ä¾èµ–

```
main.cpp
  â”œâ”€â”€ cli/ (å‘½ä»¤è¡Œ)
  â”œâ”€â”€ config/ (é…ç½®)
  â”œâ”€â”€ parser/ (ASTè§£æ)
  â”œâ”€â”€ rules/ (è§„åˆ™å¼•æ“)
  â”‚   â”œâ”€â”€ null_pointer_rule
  â”‚   â”œâ”€â”€ memory_leak_rule
  â”‚   â””â”€â”€ ...
  â”œâ”€â”€ fixer/ (è‡ªåŠ¨ä¿®å¤) â­ NEW
  â”œâ”€â”€ llm/ (LLMé›†æˆ)
  â”‚   â”œâ”€â”€ llm_enhancer
  â”‚   â””â”€â”€ api_client â­ NEW
  â”œâ”€â”€ analysis/ (é«˜çº§åˆ†æ) â­ NEW
  â”‚   â””â”€â”€ taint_analysis
  â”œâ”€â”€ git/ (Gité›†æˆ)
  â””â”€â”€ report/ (æŠ¥å‘Šç”Ÿæˆ)
```

---

## API å‚è€ƒ

### AutoFixer API

```cpp
class AutoFixer {
public:
    // æ„é€ å‡½æ•°
    explicit AutoFixer(bool create_backup = true);

    // ç”Ÿæˆä¿®å¤
    std::optional<FixAction> generateFix(const Issue& issue);

    // åº”ç”¨å•ä¸ªä¿®å¤
    bool applyFix(const FixAction& fix);

    // æ‰¹é‡ä¿®å¤
    FixResult fixAll(const Reporter& reporter,
                     Severity filter_severity = Severity::LOW);

    // è®¾ç½®é€‰é¡¹
    void setBackupEnabled(bool enable);
    void setInteractiveMode(bool enable);

    // å›æ»š
    bool rollback();
};
```

### LLM Enhancer API

```cpp
class LLMEnhancer {
public:
    explicit LLMEnhancer(std::shared_ptr<LLMProvider> provider);

    // å¢å¼ºå•ä¸ªé—®é¢˜
    Issue enhanceIssue(const Issue& issue,
                      const std::string& code_context = "");

    // å¢å¼ºæ‰€æœ‰é—®é¢˜
    void enhanceAllIssues(Reporter& reporter);

    // æ£€æŸ¥æ˜¯å¦å¯ç”¨
    bool isEnabled() const;

    // è·å–æä¾›è€…åç§°
    std::string getProviderName() const;
};
```

### Taint Analyzer API

```cpp
class TaintAnalyzer {
public:
    explicit TaintAnalyzer(clang::ASTContext* context,
                          Reporter& reporter);

    // åˆ†æå‡½æ•°
    void analyzeFunction(const clang::FunctionDecl* function);

    // è·å–æ±¡ç‚¹è·¯å¾„
    const std::vector<TaintPath>& getTaintPaths() const;
};
```

---

## æ€»ç»“

V3.0 ç‰ˆæœ¬å®ç°äº†ï¼š

âœ… **5 å¤§æ ¸å¿ƒåŠŸèƒ½æ¨¡å—**
- è‡ªåŠ¨ä»£ç ä¿®å¤
- LLM API é›†æˆ
- VS Code æ‰©å±•
- CI/CD å¤šå¹³å°é›†æˆ
- æ•°æ®æµæ±¡ç‚¹åˆ†æ

âœ… **18 ä¸ªæ–°æ–‡ä»¶**
âœ… **~3700 è¡Œæ–°ä»£ç **
âœ… **4 ä¸ª CI/CD å¹³å°é…ç½®**
âœ… **å®Œæ•´çš„æ–‡æ¡£å’Œç¤ºä¾‹**

è¿™æ ‡å¿—ç€é¡¹ç›®ä»é™æ€åˆ†æå·¥å…·å‡çº§ä¸º**å®Œæ•´çš„è‡ªåŠ¨åŒ–ä»£ç è´¨é‡å¹³å°**ï¼
